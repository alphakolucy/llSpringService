<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" href="../layui/css/layui.css" media="all">
		<style type="text/css">
			.show {
				width: 750px;
				margin: 0 auto;
				text-align: center;
			}

			.show .showimg {
				position: relative;
				width: 350px;
				height: 350px;
				border: 1px solid #707070;
				display: inline-block;
			}

			.show .showimg .img {
				width: 350px;
				height: 350px;
			}

			.show .showimg .img img {
				width: 100%;
				height: 100%;
			}

			.show .showimg .chooseimg {
				position: absolute;
				left: 50%;
				top: 50%;
				height: 50px;
				width: 50px;
				margin: -25px 0 0 -25px;
			}

			.show .showimg .chooseimg img {
				width: 100%;
				height: 100%;
				cursor: pointer;
			}

			.show .show-pdding {
				margin-left: 20px;
			}
		</style>
	</head>
	<body>
		<div class="layui-tab">
			<ul class="layui-tab-title">
				<li class="layui-this">基本信息</li>
				<li>位置图</li>
				<li>地质图</li>
				<li>柱状图/剖面图</li>
				<li>水质分析</li>
				<li>成因模式</li>
				<li>附件</li>
			</ul>
			<div class="layui-tab-content">
				<div class="layui-tab-item layui-show">
					<!--基本信息-->
					<form class="layui-form" action="">
						<b>基本信息</b>
						<div class="layui-row">
							<div class="layui-col-md6">
								<div class="layui-form-item">
									<label class="layui-form-label">编号</label>
									<div class="layui-input-block">
										<input type="text" name="codeNumber" value="s1" required lay-verify="required" placeholder="请输入"
										 autocomplete="off" class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md6">
								<div class="layui-form-item">
									<label class="layui-form-label">位置名称</label>
									<div class="layui-input-block">
										<input type="text" name="address" value="位置" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>

						</div>


						<div class="layui-row">
							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">x</label>
									<div class="layui-input-block">
										<input type="text" name="x" required lay-verify="required" value="3060227.000" placeholder="请输入"
										 autocomplete="off" class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">y</label>
									<div class="layui-input-block">
										<input type="text" name="y" required lay-verify="required" value="19222257.000" placeholder="请输入"
										 autocomplete="off" class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">海拔</label>
									<div class="layui-input-block">
										<input type="text" name="z" value="2000" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>

						</div>


						<div class="layui-row">
							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">孔深</label>
									<div class="layui-input-block">
										<input type="text" name="holeDepth" value="50" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">PH</label>
									<div class="layui-input-block">
										<input type="text" name="ph" value="7.5" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">水温</label>
									<div class="layui-input-block">
										<input type="text" name="waterTemperature" value="25" required lay-verify="required" placeholder="请输入"
										 autocomplete="off" class="layui-input">
									</div>
								</div>
							</div>
						</div>

						<div class="layui-row">
							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">涌水量</label>
									<div class="layui-input-block">
										<input type="text" name="waterInflow" value="100" required lay-verify="required" placeholder="请输入"
										 autocomplete="off" class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">开孔/出露层位</label>
									<div class="layui-input-block">
										<input type="text" name="trepanning" value="开孔/出露层位" required lay-verify="required" placeholder="请输入"
										 autocomplete="off" class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">出水段</label>
									<div class="layui-input-block">
										<input type="text" name="waterOutlet" value="出水段" required lay-verify="required" placeholder="请输入"
										 autocomplete="off" class="layui-input">
									</div>
								</div>
							</div>
						</div>

						<b>理疗天然矿泉水水质指标</b>
						<div class="layui-row">
							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">溶解性总固体</label>
									<div class="layui-input-block">
										<input type="text" name="dissolvedSolids" value="10001" required lay-verify="required" placeholder="请输入"
										 autocomplete="off" class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">二氧化碳</label>
									<div class="layui-input-block">
										<input type="text" name="co2" required value="2" lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">总硫化氢</label>
									<div class="layui-input-block">
										<input type="text" name="hydrothion" required value="3" lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>
						</div>

						<div class="layui-row">
							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">偏硅酸</label>
									<div class="layui-input-block">
										<input type="text" name="hsio" required value="4" lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">偏硼酸</label>
									<div class="layui-input-block">
										<input type="text" name="hbo2" value="5" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">溴</label>
									<div class="layui-input-block">
										<input type="text" name="br2" value="6" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>
						</div>

						<div class="layui-row">
							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">碘</label>
									<div class="layui-input-block">
										<input type="text" name="i2" value="7" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>

								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">总铁</label>
									<div class="layui-input-block">
										<input type="text" name="fe" value="8" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">砷</label>
									<div class="layui-input-block">
										<input type="text" name="asa" value="9" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>
						</div>

						<div class="layui-row">
							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">氡</label>
									<div class="layui-input-block">
										<input type="text" name="rn" value="10" required lay-verify="required" placeholder="请输入" autocomplete="off"
										 class="layui-input">
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-form-item">
									<label class="layui-form-label">水化学类型</label>
									<div class="layui-input-block">
										<input type="text" name="hydrochemicalType" value="水化学类型" required lay-verify="required" placeholder="请输入"
										 autocomplete="off" class="layui-input">
									</div>
								</div>
							</div>
						</div>

						<div class="layui-form-item">
							<div class="layui-input-block">
								<button class="layui-btn" lay-submit lay-filter="formDemo">添加</button>
								<button type="reset" class="layui-btn layui-btn-primary">重置</button>
							</div>
						</div>
					</form>
				</div>

				<div class="layui-tab-item">
					<!--位置图-->
					<div class="show">
						<div class="showimg">
							<div class="img"><img src="../img/default.png" id="seat1img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="seat1" /></div>
						</div>
						<div class="showimg show-pdding">
							<div class="img"><img src="../img/default.png" id="seat2img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="seat2" /></div>
						</div>
					</div>
				</div>

				<div class="layui-tab-item">
					<!--地质图-->
					<div class="show">
						<div class="showimg">
							<div class="img"><img src="../img/default.png" id="geology1img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="geology1" /></div>
						</div>
						<div class="showimg show-pdding">
							<div class="img"><img src="../img/default.png" id="geology2img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="geology2" /></div>
						</div>
					</div>
				</div>
				<div class="layui-tab-item">
					<!--柱状图/剖面图-->
					<div class="show">
						<div class="showimg">
							<div class="img"><img src="../img/default.png" id="columnar1img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="columnar1" /></div>
						</div>
						<div class="showimg show-pdding">
							<div class="img"><img src="../img/default.png" id="columnar2img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="columnar2" /></div>
						</div>
					</div>
				</div>
				<div class="layui-tab-item">
					<!--水质分析-->
					<div class="show">
						<div class="showimg">
							<div class="img"><img src="../img/default.png" id="waterquality1img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="waterquality1" /></div>
						</div>
						<div class="showimg show-pdding">
							<div class="img"><img src="../img/default.png" id="waterquality2img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="waterquality2" /></div>
						</div>
					</div>
				</div>
				<div class="layui-tab-item">
					<!--成因模式-->
					<div class="show">
						<div class="showimg">
							<div class="img"><img src="../img/default.png" id="model1img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="model1" /></div>
						</div>
						<div class="showimg show-pdding">
							<div class="img"><img src="../img/default.png" id="model2img"></div>
							<div class="chooseimg"><img src="../img/addimg.png" id="model2" /></div>
						</div>
					</div>
				</div>
				<div class="layui-tab-item">
					<!--附件-->
					<button type="button" class="layui-btn" id="uploadfile">
						<i class="layui-icon">&#xe67c;</i>上传附件
					</button>
					<div class="layui-upload-list">
						<table class="layui-table">
							<thead>
								<tr>
									<th>附件名称</th>
                                    <th>创建时间</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody id="filesList"></tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="../Api.js"></script>
		<script type="text/javascript" src="../layui/layui.js"></script>
		<script type="text/javascript">
			layui.use(['upload', 'element', 'form', 'jquery'], function() {
				var upload = layui.upload;
				var element = layui.element;
				var form = layui.form;
				var $ = layui.jquery;
				var pointid = 0;
				var codeNumber = 0;
				
				//监听提交
				form.on('submit(formDemo)', function(data) {
					var fromdata = data.field;
					//添加温泉点
					$.ajax({
						type: "POST",
						url: apiUrl + "/springPoint/addPoint",
						data: fromdata,
						dataType: "json",
						success: function(data) {
							if (data.hasOwnProperty("id")) {
								layer.msg('添加成功', {
									icon: 1,
									time: 1000
								}, function() {
									pointid=data.id;
									codeNumber = data.codeNumber;
									window.parent.readdpoint([fromdata.y/pointrotiox, fromdata.x/pointrotioy], fromdata);
									// var index = parent.layer.getFrameIndex(window.name);
									// parent.layer.close(index);
								});
							} else {
								layer.msg('添加失败', {
									icon: 5,
									time: 1000
								}, function() {});
							}
						},
						errorfunction(data) {
							console.log(data);
							layer.msg('添加失败', {
								icon: 5,
								time: 1000
							}, function() {});
						}
					});
					return false;

				});
				var uploadimgids = [{
					"id": "#seat1",
					"picState": 10001
				}, {
					"id": "#seat2",
					"picState": 10001
				}, {
					"id": "#geology1",
					"picState": 10002
				}, {
					"id": "#geology2",
					"picState": 10002
				}, {
					"id": "#columnar1",
					"picState": 10003
				}, {
					"id": "#columnar2",
					"picState": 10003
				}, {
					"id": "#waterquality1",
					"picState": 10004
				}, {
					"id": "#waterquality2",
					"picState": 10004
				}, {
					"id": "#model1",
					"picState": 10005
				}, {
					"id": "#model2",
					"picState": 10005
				}];

				$.each(uploadimgids, function(idnex, item) {
					upload.render({
						elem: item.id,
						url: apiUrl + '/upload/image',
						data: {
							filetype: "images",
							PicState: item.picState,
							pointId: 0,
							codeNumber: 0
						},
						auto: false,
						accept: 'images',
						acceptMime: 'image/*',
						size: 51200,
						choose: function(obj) {
							if (pointid == 0) {
								layer.msg('请先保存基础数据', {
									icon: 5,
									time: 1000
								}, function() {});
							} else {
								this.data.pointId = pointid;
								this.data.codeNumber = codeNumber;
								obj.preview(function(index, file, result) {
									$(item.id + 'img').attr("src", result);
									obj.upload(index, file);
								});
							}
						},
						before: function(res) {
							layer.load();
						},
						done: function(res) {
							layer.closeAll('loading');
							if(res.hasOwnProperty("springPointPic")){
								layer.msg('图片上传成功', {
									icon: 1,
									time: 1000
								}, function() {});
								this.data.id=res.springPointPic.pid;
							}else{
								layer.msg('图片上传失败', {
									icon: 5,
									time: 1000
								}, function() {
									$(item.id + 'img').attr("src", "../img/default.png");
								});
							}
						},
						error: function() {
							layer.closeAll('loading');
							$(item.id + 'img').attr("src", "../img/default.png");
						},
					});
				});
				var filesListView = $('#filesList');
				var uploadfiles = upload.render({
					elem: "#uploadfile",
					url: apiUrl + '/upload/file',
					data: {
						filetype: "file",
						PicState: 10006,
						poinId: 0,
						codeNumber: 0
					},
					accept: 'file',
					// multiple: true,
					auto: false,
					size: 520,
					choose: function(obj) {
						if (pointid == 0) {
							layer.msg('请先保存基础数据', {
								icon: 5,
								time: 1000
							}, function() {});
						} else {
							if (filesListView.find("tr").length >= 10) {
								layer.msg('附件超出限制，请先删除附件后重试！', {
									icon: 5,
									time: 1000 //2秒关闭（如果不配置，默认是3秒）
								}, function() {
									//do something
								});
								return false;
							};
							this.data.poinId = pointid;
							this.data.codeNumber = codeNumber;
							var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
							obj.preview(function(index, file, result) {
								obj.upload(index, file);
							});
						}
					},
					before: function(res) {
						layer.load();
					},
					done: function(res) {
						layer.closeAll('loading');
						if(res.hasOwnProperty("springPointPic")){
							var tr = $(['<tr id="0">', '<td>' + res.springPointPic.fileName + '</td>',
                                '<td>' + res.springPointPic.createTime + '</td>',
								'<button layui-url='+res.springPointPic.url+' class="layui-btn layui-btn-xs demo-down">下载</button>',
								'<button layui-pid='+res.springPointPic.id+' class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>', '</td>', '</tr>'
							].join(''));
							//删除
							tr.find('.demo-delete').on('click', function() {
								$.ajax({
									type: "DELETE",
									url: apiUrl + "/upload?id="+$(this).attr("layui-pid"),
									success: function(data) {
										layer.msg('删除成功', {
											icon: 1,
											time: 1000
										}, function() {
											tr.remove();
											uploadfiles.config.elem.next()[0].value = '';
										});
									},
									error:function(data) {
										console.log(data);
										layer.msg('删除失败', {
											icon: 5,
											time: 1000
										}, function() {});
									}
								});
							});
							//下载
							tr.find('.demo-down').on('click', function() {
								var a = document.createElement('a');
								a.setAttribute('href', $(this).attr("layui-url"));
								a.setAttribute('target', '_blank');
								a.click();
							});
							filesListView.append(tr);
							layer.msg('附件上传成功', {
								icon: 1,
								time: 1000
							}, function() {});
						}else{
							layer.msg('附件上传失败', {
								icon: 5,
								time: 1000
							}, function() {
								
							});
						}
					},
					error: function() {
						layer.closeAll('loading');
					},
				});
			});
		</script>
	</body>
</html>
